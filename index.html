<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>LIPS Lead Testing Site</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
<div class="wrap">
  <!-- CONFIG PANEL -->
  <div class="card" id="configCard">
    <div class="row" style="align-items:center;">
      <h1>LIPS Lead Testing Site</h1>
      <span id="captureStatus" class="status warn">Capture SDK not initialized</span>
    </div>

    <!-- Step 1 header -->
    <div class="step-header">
      <div class="step-tag">Step 1</div>
      <div>
        <div class="step-title">Configure account & environment</div>
        <div class="step-desc">
          Enter/select a GMAID, API key, and environment, then click <strong>Next</strong>.
          For now we use a mock site config response and log the parsed data.
        </div>
      </div>
    </div>

    <div class="grid" style="margin-top:10px;">
      <!-- GMAID (first stop) -->
      <div class="col-4">
        <label for="cfg-gmaid">gmaid</label>
        <div class="combo" data-key="gmaid">
          <input id="cfg-gmaid" class="combo-input" placeholder="e.g., USA_172716" />
          <button type="button" class="combo-btn" aria-label="Show presets">▾</button>
          <ul class="combo-list" role="listbox" hidden></ul>
        </div>
      </div>

      <!-- API key combo -->
      <div class="col-8">
        <label for="cfg-apikey">API key</label>
        <div class="combo" data-key="apikey">
          <input id="cfg-apikey" class="combo-input" placeholder="Stored in this browser only" />
          <button type="button" class="combo-btn" aria-label="Show saved keys">▾</button>
          <ul class="combo-list" role="listbox" hidden></ul>
        </div>
      </div>

      <!-- SCID (populated from GMAID lookup) -->
      <div class="col-4">
        <label for="cfg-scid">scid (from GMAID lookup)</label>
        <select id="cfg-scid">
          <option value="">– select SCID –</option>
          <option value="3871830">3871830 (default)</option>
        </select>
      </div>

      <!-- siteid -->
      <div class="col-4">
        <label for="cfg-siteid">siteid</label>
        <div class="combo" data-key="siteid">
          <input id="cfg-siteid" class="combo-input" placeholder="e.g., 427e4e5f-..." />
          <button type="button" class="combo-btn" aria-label="Show presets">▾</button>
          <ul class="combo-list" role="listbox" hidden></ul>
        </div>
      </div>

      <!-- ENV -->
      <div class="col-2">
        <label for="cfg-env">environment</label>
        <select id="cfg-env">
          <option value="qa" selected>qa</option>
          <option value="stage">stage</option>
          <option value="prod">prod</option>
        </select>
      </div>

      <!-- Step 1 Next button -->
      <div class="col-2" style="display:flex; align-items:flex-end; gap:8px; justify-content:flex-end;">
        <button class="btn primary" id="step1NextBtn" type="button">Next: Load Site Config (mock)</button>
      </div>

      <!-- Buttons -->
      <div class="col-12" style="display:flex; align-items:flex-end; gap:8px; justify-content:flex-end; margin-top:8px;">
        <button class="btn" id="applyCfgBtn" title="Update URL & re-init capture">Apply</button>
        <button class="btn ghost" id="resetCfgBtn" title="Reset to defaults">Reset</button>
      </div>

      <!-- Dry-run -->
      <div class="col-12" style="display:flex;justify-content:flex-end;align-items:center;margin-top:4px;">
        <div class="switch" title="When on, no lead is created; payload only logs.">
          <span class="label">Dry-run</span>
          <input type="checkbox" id="dryRun" />
        </div>
      </div>
    </div>
    <div class="hr"></div>
    <div class="row" style="align-items:center; justify-content:space-between;">
      <div class="seg" role="tablist" aria-label="Lead Type">
        <span class="pill">Lead type:</span>
        <button class="btn" data-leadtype="web" aria-pressed="true">Web Form</button>
        <button class="btn" data-leadtype="call" aria-pressed="false">Call</button>
        <button class="btn" data-leadtype="chatbot" aria-pressed="false">Chatbot</button>
      </div>
      <div class="hint">Config persists in the page URL so you can share the link (API key stays local-only).</div>
    </div>
  </div>
  <!-- STEP 2: Campaign / SCID selection -->
  <div class="card" id="step2Card" style="display:none;">
    <h2>Step 2 — Choose campaign & SCID</h2>
    <p class="hint">
      After parsing the site-config, choose which campaign/SCID you want to use for your test scenario.
    </p>

    <div id="step2Body">
      <p class="hint">Run <strong>Step 1</strong> first to load SCIDs from the mock site-config.</p>
    </div>

    <div class="row" style="margin-top:16px;justify-content:flex-end;gap:8px;">
      <button type="button" class="btn ghost" id="step2BackBtn">Back to Step 1</button>
      <button type="button" class="btn primary" id="step2NextBtn" disabled>
        Next: Visit & Event (later)
      </button>
    </div>
  </div>


  <div style="height:16px;"></div>

  <!-- LEAD FORM -->
  <form class="card" id="leadForm" novalidate>
    <h2>Lead Form</h2>
    <div class="grid">
      <div class="col-6">
        <label for="first_name">First Name</label>
        <input id="first_name" name="first_name" autocomplete="given-name" />
      </div>
      <div class="col-6">
        <label for="last_name">Last Name</label>
        <input id="last_name" name="last_name" autocomplete="family-name" />
      </div>

      <div class="col-6">
        <label for="email">Email <span class="hint">(email OR phone required)</span></label>
        <input id="email" name="email" type="email" autocomplete="email" />
        <input id="xhr_form_email" name="xhr_form_email" type="hidden" />
      </div>
      <div class="col-6">
        <label for="phone">Phone <span class="hint">(email OR phone required)</span></label>
        <input id="phone" name="phone" type="tel" inputmode="tel" autocomplete="tel" />
        <input id="xhr_form_phone" name="xhr_form_phone" type="hidden" />
      </div>

      <div class="col-12"><div class="hr"></div></div>

      <div class="col-8">
        <label for="address1">Address 1</label>
        <input id="address1" name="address1" autocomplete="address-line1" />
      </div>
      <div class="col-4">
        <label for="address2">Address 2</label>
        <input id="address2" name="address2" autocomplete="address-line2" />
      </div>

      <div class="col-5">
        <label for="city">City</label>
        <input id="city" name="city" autocomplete="address-level2" />
      </div>
      <div class="col-3">
        <label for="state">State/Province</label>
        <input id="state" name="state" maxlength="32" />
      </div>
      <div class="col-4">
        <label for="postal_code">ZIP/Postal Code</label>
        <input id="postal_code" name="postal_code" autocomplete="postal-code" />
      </div>

      <div class="col-12">
        <label for="notes">Notes</label>
        <textarea id="notes" name="notes" placeholder="Free-form text to help identify the test lead in LIPS…"></textarea>
      </div>

      <div class="col-12 row" style="align-items:center; justify-content:space-between;">
        <div class="hint">On submit, we call the Capture API if available; otherwise we log a payload (“dry-run”).</div>
        <div class="row" style="gap:8px;">
          <span id="submitStatus" class="badge badge-hidden" aria-live="polite" title="Submission status"></span>
          <button type="button" class="btn" id="fillDemo">Fill demo data</button>
          <button type="submit" class="btn primary">Create Lead</button>
        </div>
      </div>
    </div>
  </form>
</div>

<!-- ===== Network Console (logs fetch + XHR) ===== -->
<div id="dbg" style="position:fixed;right:12px;bottom:56px;left:12px;background:#0b1020;border:1px solid #1f2a44;border-radius:10px;padding:10px;max-height:35vh;overflow:auto;font:12px ui-monospace,Menlo,monospace;color:#dbe7ff;z-index:9999;">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
    <strong>Network Console</strong>
    <div style="display:flex;gap:8px;align-items:center;">
      <button id="dbgCollapse" style="background:#122049;border:1px solid #2a3e6f;color:#fff;border-radius:8px;padding:4px 8px;cursor:pointer;">Collapse</button>
      <button id="dbgExpand"   style="background:#122049;border:1px solid #2a3e6f;color:#fff;border-radius:8px;padding:4px 8px;cursor:pointer;">Expand</button>
      <button id="dbgCopy"     style="background:#122049;border:1px solid #2a3e6f;color:#fff;border-radius:8px;padding:4px 8px;cursor:pointer;">Copy</button>
      <button id="dbgClear"    style="background:#122049;border:1px solid #2a3e6f;color:#fff;border-radius:8px;padding:4px 8px;cursor:pointer;">Clear</button>
      <button id="dbgHide"     style="background:#122049;border:1px solid #2a3e6f;color:#fff;border-radius:8px;padding:4px 8px;cursor:pointer;">Hide</button>
    </div>
  </div>
  <pre id="dbgOut" style="white-space:pre-wrap;margin:8px 0 0;"></pre>
</div>

<!-- Floating toggle (appears when console hidden) -->
<button id="dbgToggle" title="Show network console">Show Console</button>

<!-- JS: legacy Capture bootstrap (needs to run early) -->
<script src="js/capture-bootstrap.js"></script>

<!-- JS: network console + fetch/xhr patch + status badge helper -->
<script src="js/network-console.js"></script>

<!-- JS: main app logic (ES modules) -->
<script type="module" src="js/app.js"></script>
</body>
</html>
